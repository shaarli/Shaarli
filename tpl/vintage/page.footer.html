<div id="footer">
  <strong><a href="https://github.com/shaarli/Shaarli">Shaarli</a></strong>
  - The personal, minimalist, super-fast, database free, bookmarking service by the Shaarli community
  - <a href="doc/html/index.html" rel="nofollow">Help/documentation</a>
    {loop="$plugins_footer.text"}
        {$value}
    {/loop}
</div>

{loop="$plugins_footer.endofpage"}
    {$value}
{/loop}

{if="$newVersion"}
<div id="newversion">
  <span id="version_id">&#x25CF;</span> Shaarli {$newVersion} is
  <a href="https://github.com/shaarli/Shaarli/releases">available</a>.
</div>
{/if}
{if="$versionError"}
<div id="newversion">
  Error: {$versionError}
</div>
{/if}

{if="$is_logged_in"}
<script>function confirmDeleteLink() { var agree=confirm("Are you sure you want to delete this link ?"); if (agree) return true ; else return false ; }</script>
{/if}

{loop="$plugins_footer.js_files"}
	<script src="{$base_path}/{$value}#"></script>
{/loop}

<input type="hidden" name="js_base_path" value="{$base_path}" />
<input type="hidden" name="token" value="{$token}" id="token" />
<input type="hidden" name="tags_separator" value="{$tags_separator}" id="tags_separator" />

<script src="{$asset_path}/js/shaarli.min.js#"></script>
<script>
function autofillTimeZone() {
  try {
    curZoneName = Intl.DateTimeFormat().resolvedOptions().timeZone
    cur = curZoneName.split('/');
    continent = cur[0];
    cur.shift()
    city = cur.join('/');
    conEl = document.querySelector('#continent');
    cityEl = document.querySelector('#city');
    conEl.value = continent;
    conEl.dispatchEvent(new Event('change')); // set value attribute doesn't trigger the change or input event.
    cityEl.value = city;
    return true;
  } catch {
    return false;
  }
}

// e.g. old browsers.
function autofillTimeZone_alert() {
  if(!autofillTimeZone()) {
    alert('Automatic detection and filling failed!'); // TODO: i18n
  }
}

// Update the select list, otherwise it is old.
function citiesUpdates() {
  conEl = document.querySelector('#continent');
  cityEls = document.querySelectorAll('#city>option');
  conEl.addEventListener('change', () => {
    let newConName = conEl.value;
    let firstSelected = false;
    for (let el of cityEls) {
      let show = el.dataset.continent == newConName;
      el.className = show ? "" : "hidden";
      if (!firstSelected && show) { // Ensure the selected visible
        el.selected = true;
        firstSelected = true;
      }
    }
    cityEl = document.querySelector('#city');
  });
}
document.addEventListener("DOMContentLoaded", citiesUpdates);
</script>
